<?xml version="1.0" encoding="utf-8"?>
<framework>
  	<persistent>
		<xlog-enable>false</xlog-enable>
	    <db-trace>true</db-trace>
    	<datasources>
    	<jdbc-pool name="default">
                <max-active-connections>1</max-active-connections>
                <max-idle-connections>1</max-idle-connections>
                <max-checkout-time>20000</max-checkout-time>
                <wait-time>15000</wait-time>
                <ping-query>No Ping QUERY SET</ping-query>
                <ping-enabled>false</ping-enabled>
                <ping-connection-time>0</ping-connection-time>
                <ping-connections-notused>0</ping-connections-notused>
                <quiet-mode>true</quiet-mode>
            </jdbc-pool>

      		<datasource name="devon">
		        <driver>oracle.jdbc.driver.OracleDriver</driver>
		        <url>jdbc:oracle:thin:@dsubds01.czjqopx1zvei.ap-northeast-2.rds.amazonaws.com:1522:DSUBDS01</url>
		        <user>DEVON</user>
		        <password>9438xUkvBqVtmN+CRmYy+g==</password>
		        <crypto-ref>AES</crypto-ref>
		        <jdbc-pool>default</jdbc-pool>
                <connection-interceptor>devonenterprise.ext.persistent.connection.ConnectionInterceptor</connection-interceptor>
      		</datasource>

      		<!--  배치통합 -->
      		<datasource name="default">
		        <driver>oracle.jdbc.driver.OracleDriver</driver>
		        <url>jdbc:oracle:thin:@dsubds01.czjqopx1zvei.ap-northeast-2.rds.amazonaws.com:1522:DSUBDS01</url>
		        <user>UBDBAT</user>
		        <password>w95t2ry4x0ix8AZg33pnuQ==</password>
		        <crypto-ref>AES</crypto-ref>
		        <jdbc-pool>default</jdbc-pool>
		        <connection-interceptor>devonenterprise.ext.persistent.connection.ConnectionInterceptor</connection-interceptor>
                <interceptors>
                	<interceptor>devonenterprise.ext.persistent.dao.interceptor.LAutoDaoInterceptor</interceptor>
                </interceptors>
      		</datasource>
		</datasources>
    		 
        <!-- ================================================================================================
        * 설    명 : 컬럼명에 대한 Naming 정책 (Camel, Lower, AsIs)
        * 관련소스 : devonframework.persistent.util.LResultSetConverter
        ================================================================================================== -->
        <resultset-converter>
            <!-- <naming>devonframework.persistent.util.LDefaultNaming</naming> -->
            <naming>devonframework.persistent.util.AsIsNaming</naming>
            <metadata>false</metadata>
            <date-to-timestamp-enabled>false</date-to-timestamp-enabled>
        </resultset-converter>
        		 
    	<!-- <auto-dao>
      	    <lob-mapping>true</lob-mapping>    	
      		<transaction-enabled>true</transaction-enabled>
      		Oracle
      		<dup-error-code>1</dup-error-code> ORA-00001
      		<selectforupdate-error-code>54;30006</selectforupdate-error-code> ORA-00054, ORA-30006
      		
    	</auto-dao> -->
    	
    	<auto-dao>
            <default-transaction-manager>jdbc</default-transaction-manager>
            <query-type>dynamic</query-type>
            <sql-pattern>INSERT|SELECT|UPDATE|DELETE|TRUNCATE|CREATE|DROP|WITH|CALL|EXECUTE|ALTER</sql-pattern>
            <lob-mapping>true</lob-mapping>
            <transaction-enabled>true</transaction-enabled>
            <sql-exception-translator>
                <!-- LSqlStateSQLExceptionTranslator -->
                <!-- Oracle -->
                <class>devonenterprise.ext.core.exception.LSqlStateSQLExceptionTranslator</class>
                <selectforupdate-nowait-code>54</selectforupdate-nowait-code>
                <selectforupdate-wait-code>30006</selectforupdate-wait-code>
                <duplicate-code>1</duplicate-code>
                <timeout-cancel-code>1013</timeout-cancel-code>
                <cannot-insert-null-code>1400</cannot-insert-null-code>
            </sql-exception-translator>
        </auto-dao>
   
    	<dynamic-query>
      		<directory>#home/../devonhome/xmlquery</directory>
      		<sql-injection>
          		<sieve>";:#\/*</sieve>
      		</sql-injection>
      		<class>devonframework.persistent.query.type.LQueryXmlType</class><!-- LQueryXmlType, LQueryDefaultDbType -->
      		<default-datasource-ref>devon</default-datasource-ref>
      		<default-table-name>TDO_STMT_INFO</default-table-name>
      		<columns>
          		<type>BUZ_CD</type>
          		<statement-name>STMT_ID</statement-name>
          		<query>STMT</query>
          		<metadata>METADATA</metadata>
          		<fetchsize>FETCHSIZE</fetchsize>
          		<postfix>POSTFIX</postfix>
      		</columns>
    	</dynamic-query>
    	
    	<!-- 배치에서 LCommonDao를 사용하여 조회하는 경우 건수 제한 설정 -->
    	<rowcount-limit>
    		<limit-count>10000</limit-count>
    		<data-cut>false</data-cut> <!-- false시 Exception 발생 -->
    	</rowcount-limit>
  	</persistent>
  
     <!-- ================================================================================================
    * 설    명 : 채번서비스 설정
    * 관련소스 : devonframework.service.idgenerator.LIDGeneratorManager
                 devonframework.service.idgenerator.policy.LIDGeneratorPolicyIF
                 devonframework.service.idgenerator.formatter.LIDGeneratorFormatterIF
    ================================================================================================== -->
    <id-generator>
        <!-- 기본제공 채번서비스 -->
        <!-- DB Sequence 에서 채번 -->
        <policy name="sequence">
            <class>devonframework.service.idgenerator.policy.LDBSequencePolicy</class>
            <formatter-ref>default</formatter-ref>
            <query>SELECT SEQUENCE.NEXTVAL FROM DUAL</query>
            <datasource-ref>default</datasource-ref>
            <decimal-enabled>true</decimal-enabled>
        </policy>
        
        <!-- 기본제공 채번서비스 -->
        <!-- Table 에서 채번 -->
        <policy name="table">
            <class>devonframework.service.idgenerator.policy.LTableIDPolicy</class>
            <formatter-ref>default</formatter-ref>
            <id-table>테이블명</id-table>
            <key-column>키컬럼명</key-column>
            <sequence-column>채번컬럼명</sequence-column>
            <key-value>키값</key-value>
            <lock-select>true</lock-select>
            <lock-wait>0</lock-wait>
            <datasource-ref>default</datasource-ref>
            <decimal-enabled>false</decimal-enabled>
            <transaction-enabled>true</transaction-enabled>
            <retry-count>5</retry-count>
        </policy>
        
        <policy name="guid">
            <class>devonenterprise.ext.service.idgenerator.policy.GUIDGeneratorPolicy</class>
            <formatter-ref>guid</formatter-ref>
        </policy>
        
        <policy name="bankguid">
            <class>devonenterprise.ext.service.idgenerator.policy.GUIDGeneratorPolicy</class>
            <formatter-ref>bankguid</formatter-ref>
        </policy>
        
         <policy name="batguid">
            <class>devonenterprise.ext.service.idgenerator.policy.BatchGUIDGeneratorPolicy</class>
            <formatter-ref>batguid</formatter-ref>
        </policy>
        
        <policy name="bizlog">
            <class>devonenterprise.ext.service.idgenerator.policy.BizLogIDGeneratorPolicy</class>
            <formatter-ref>bizlog</formatter-ref>
        </policy>
        
        <!-- Formatter -->
        <formatter name="default">
            <class>devonframework.service.idgenerator.formatter.LDefaultIDGeneratorFormatter</class>
            <seperator></seperator>
            <sequence-size></sequence-size>
            <fill-char></fill-char>
            <prefix></prefix>
        </formatter>

        <formatter name="guid">
            <class>devonenterprise.ext.service.idgenerator.formatter.GUIDGeneratorFormatter</class>
        </formatter>
        
        <formatter name="bankguid">
            <class>devonenterprise.ext.service.idgenerator.formatter.GUIDGeneratorFormatter</class>
        </formatter>
        
        <formatter name="bizlog">
            <class>devonenterprise.ext.service.idgenerator.formatter.BizLogIDGeneratorFormatter</class>
        </formatter>
        
        <formatter name="batguid">
            <class>devonenterprise.ext.service.idgenerator.formatter.BatchGUIDGeneratorFormatter</class>
        </formatter>
        
    </id-generator>
     
	<!-- Message setting for DevOn/Monitoring -->
    <message>
    	<spec name="default">
        	<resource-type>devonframework.service.message.LMessageDB</resource-type>
        	<resource-name>SGRV_MESSAGE</resource-name>
        	<dbspec>devon</dbspec>
        	<preload>false</preload>
        	<capital-small-letter>true</capital-small-letter>
        	<column>
            	<code-column>MESG_ID</code-column>
            	<message-column>MESG_CTNT</message-column>
            	<locale-column>LANG_CD</locale-column>
            	<important-column>IMPORTANT_YN</important-column>
            	<table-manage>
                	<single-manage>true</single-manage>
            	</table-manage>
        	</column>
        	<validation>false</validation>        	
    	</spec> 
	</message>  

  	<business>
    	<transaction>
      		<manager name="jdbc">
        		<class>devonframework.business.transaction.jdbc.LJDBCTransactionManager</class>
      		</manager>
      		<manager name="jta">
        		<class>devonframework.business.transaction.jta.LJTATransactionManager</class>
        		<!-- <jndi-name>java:comp/env/jdbc/devonxa</jndi-name>
        		<context-factory>weblogic.jndi.WLInitialContextFactory</context-factory>
        		<provider-url>t3://localhost:7001</provider-url>
        		-->        		
        		<was-type>weblogic</was-type>
        		<transaction-factory>weblogic.transaction.TxHelper</transaction-factory>
        	</manager>
      		<manager name="nested">
        		<class>devonframework.business.transaction.nested.LNestedTransactionManager</class>
        		<default-type>jdbc</default-type> <!-- jdbc, jta -->
      		</manager>
    	</transaction>
    	
    	<service-proxy>      
      		<system-interceptor>devonenterprise.ext.business.interceptor.SystemInterceptor</system-interceptor>       
      		<service-link-interceptor>devonx.finast.business.interceptor.LServiceLinkInterceptor</service-link-interceptor>
		    <sc-mediator>
		        <enabled>true</enabled>
		        <mediator>
		            <class-name>devonenterprise.business.mediator.sc.ServiceMediator</class-name>
		        </mediator>
		    </sc-mediator>
      		<spec name="noTx">
          		<transaction-enabled>false</transaction-enabled>          
      		</spec>
      		<spec name="tx">
          		<transaction-enabled>true</transaction-enabled>
          		<transaction-manager-ref>jdbc</transaction-manager-ref>
      		</spec>
      		<spec name="xaTx">
          		<transaction-enabled>true</transaction-enabled>
          		<transaction-manager-ref>jta</transaction-manager-ref>
      		</spec>
      		<spec name="userDefineTx">
          		<transaction-enabled>false</transaction-enabled>
      		</spec>
    	</service-proxy>
  	</business>

</framework>
