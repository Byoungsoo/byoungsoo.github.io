<?xml version="1.0" encoding="UTF-8"?>
<statements>
	
	<statement name="selectUsrScopCtt">
		<![CDATA[
		SELECT /*+ 이요한::/idv/IdvCtfACEbc/selectUsrScopCtt */
		         A.마이데이터제공기관코드            AS MYDT_OFER_INS_CD
		       , A.마이데이터업권구분코드            AS MYDT_BSZ_DTCD
		       , A.마이데이터사업자기관코드          AS MYDT_BZM_INS_CD
		       , A.마이데이터클라이언트식별번호      AS MYDT_CLINT_IDI_NO
		       , A.CI내용                            AS CI_CTT
		       , A.마이데이터권한영역내용            AS MYDT_ATR_SCOP_CTT
		  FROM INSTC.TBUBDC015 A
		 WHERE A.마이데이터제공기관코드 = ${mydt_ofer_ins_cd}
		   AND A.마이데이터업권구분코드 = ${mydt_bsz_dtcd}
		   AND A.마이데이터사업자기관코드 = ${mydt_bzm_ins_cd}
		   AND A.마이데이터클라이언트식별번호 = ${mydt_clint_idi_no}
		   AND A.CI내용 = ${ci_ctt}
		]]>
	</statement>
	<statement name="selectUsrAtHis">
		SELECT /*+ 이요한::/idv/IdvCtfACEbc/selectUsrAtHis */
		       A.마이데이터거래고유번호       AS MYDT_TR_UNO
		     , A.마이데이터거래요청년월일     AS MYDT_TR_DMD_YMD
		     , A.마이데이터토큰구분코드       AS MYDT_TKEN_DTCD
		     , A.마이데이터전송대상구분코드   AS MYDT_TRS_TG_DTCD
		     , A.마이데이터인증구분코드       AS MYDT_CTF_DTCD
		     , A.마이데이터업권구분코드       AS MYDT_BSZ_DTCD
		     , A.마이데이터제공기관코드       AS MYDT_OFER_INS_CD
		     , A.마이데이터사업자기관코드     AS MYDT_BZM_INS_CD
		     , A.마이데이터클라이언트식별번호 AS MYDT_CLINT_IDI_NO
		     , A.CI내용                       AS CI_CTT
		     , A.고객식별자                   AS CST_IDF
		     , A.고객관리번호                 AS CST_MG_NO
		     , A.고객최초등록년월일           AS CST_FST_RG_YMD
		     , A.접근토큰유효기간초수         AS AT_EXPT_SS_CNT
		     , A.접근토큰만료일시             AS AT_EXY_YMS
		     , A.마이데이터권한영역내용       AS MYDT_ATR_SCOP_CTT
		     , A.접근토큰폐기여부             AS AT_DSCR_YN
		     , A.접근토큰폐기사유구분코드     AS ACCS_TKEN_DSCR_RSN_DTCD
		     , A.접근토큰폐기일시             AS AT_DSCR_YMS
		     , A.접근토큰식별번호             AS AT_IDI_NO
		     , A.마이데이터토큰내용           AS MYDT_TKEN_CTT
		  FROM INSTC.TBUBDC023 A
		 WHERE A.마이데이터제공기관코드 = ${mydt_ofer_ins_cd}
		   AND A.마이데이터업권구분코드 = ${mydt_bsz_dtcd}
		   AND A.마이데이터사업자기관코드 = ${mydt_bzm_ins_cd}
		   AND A.마이데이터클라이언트식별번호 = ${mydt_clint_idi_no}
		   AND A.CI내용 = ${ci_ctt}
	</statement>
	<statement name="selectUsrAtRefresh">
		<![CDATA[
		SELECT /*+ 이요한::/idv/IdvCtfACEbc/selectUsrAtRefresh */
		       A01.마이데이터거래고유번호
		     , A01.마이데이터거래요청년월일
		     , A01.마이데이터전송대상구분코드
		     , A01.마이데이터인증구분코드
		     , A01.마이데이터업권구분코드
		     , A01.마이데이터제공기관코드
		     , A01.마이데이터사업자기관코드
		     , A01.마이데이터서비스명
		     , A01.CI내용
		     , A01.고객식별자
		     , A01.고객관리번호
		     , A01.마이데이터토큰구분코드
		     , A01.접근토큰유효기간초수
		     , A01.접근토큰만료일시
		     , A01.마이데이터권한영역내용
		     , A01.접근토큰폐기여부
		     , A01.접근토큰폐기사유구분코드
		     , A01.접근토큰폐기일시
		     , A01.접근토큰식별번호
		     , A01.마이데이터토큰내용
		  FROM INSTC.TBUBDC023 A01
		 WHERE A01.CI내용 = ${dmd_mydt_tr_uno}
		   AND A01.마이데이터제공기관코드 = ${dmd_mydt_tr_dmd_ymd}
		   AND A01.마이데이터사업자기관코드 = ${dmd_mydt_tr_dmd_ymd}
		   AND A01.마이데이터서비스명 = ${dmd_mydt_tr_dmd_ymd}
		]]>
	</statement>
	
	<statement name="deleteUsrAc">
		<![CDATA[
		DELETE /*+ 이요한::/idv/IdvCtfACEbc/deleteUsrAc */
		  FROM INSTC.TBUBDC023
		 WHERE CI내용 = ${ci_ctt}
		   AND 마이데이터제공기관코드 = ${mydt_ofer_ins_cd}
		   AND 마이데이터사업자기관코드 = ${mydt_bzm_ins_cd}
		   AND 마이데이터클라이언트식별번호 = ${mydt_clint_idi_no}
		]]>
	</statement>
	<statement name="deleteUsrAcHis">
		<![CDATA[
		DELETE /*+ 이요한::/idv/IdvCtfACEbc/deleteUsrAc */
		  FROM INSTC.TBUBDC024
		 WHERE CI내용 = ${ci_ctt}
		   AND 마이데이터제공기관코드 = ${mydt_ofer_ins_cd}
		   AND 마이데이터사업자기관코드 = ${mydt_bzm_ins_cd}
		   AND 마이데이터클라이언트식별번호 = ${mydt_clint_idi_no}
		]]>
	</statement>
	<statement name="updateUsrAcHis">
		<![CDATA[
		UPDATE /*+ 이요한::/idv/IdvCtfACEbc/updateUsrAcHis */
		       INSTC.TBUBDC023
		   SET 접근토큰폐기여부 = 'Y'
		     , 접근토큰폐기사유구분코드 = '03'
		     , 접근토큰폐기일시 = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			 , 시스템최종갱신일시    = SYSTIMESTAMP
			 , 시스템최종갱신식별자  = ${시스템최종갱신식별자}
			 , 시스템최종거래일시   = TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF6')
		 WHERE CI내용 = ${dmd_mydt_tr_uno}
		   AND 마이데이터제공기관코드 = ${dmd_mydt_tr_dmd_ymd}
		   AND 마이데이터사업자기관코드 = ${dmd_mydt_tr_dmd_ymd}
		   AND 마이데이터서비스명 = ${dmd_mydt_tr_dmd_ymd}
		   AND 마이데이터클라이언트식별번호 = ${mydt_clint_idi_no}
		]]>
	</statement>
	<statement name="insertUsrAc">
		INSERT INTO /*+ 이요한::/idv/IdvCtfACEbc/insertUsrAc */
		            INSTC.TBUBDC023
		     ( 마이데이터거래고유번호
		     , 마이데이터거래요청년월일
		     , 마이데이터토큰구분코드
		     , 마이데이터전송대상구분코드
		     , 마이데이터인증구분코드
		     , 마이데이터업권구분코드
		     , 마이데이터제공기관코드
		     , 마이데이터사업자기관코드
		     , 마이데이터클라이언트식별번호
		     , CI내용
		     , 고객식별자
		     , 고객관리번호
		     , 고객최초등록년월일
		     , 접근토큰유효기간초수
		     , 접근토큰만료일시
		     , 마이데이터권한영역내용
		     , 접근토큰폐기여부
		     , 접근토큰폐기사유구분코드
		     , 접근토큰폐기일시
		     , 접근토큰식별번호
		     , 마이데이터토큰내용
		     , 시스템최종갱신일시
		     , 시스템최종갱신식별자
		     , 시스템최종거래일시
		     )
		VALUES
		     ( ${mydt_tr_uno}
		     , ${mydt_tr_dmd_ymd}
		     , ${mydt_tken_dtcd}
		     , ${mydt_trs_tg_dtcd}
		     , ${mydt_ctf_dtcd}
		     , ${mydt_bsz_dtcd}
		     , ${mydt_ofer_ins_cd}
		     , ${mydt_bzm_ins_cd}
		     , ${mydt_clint_idi_no}
		     , ${ci_ctt}
		     , ${cst_idf}
		     , ${cst_mg_no}
		     , ${cst_fst_rg_ymd}
		     , ${at_expt_ss_cnt} / 1000
		     , ${at_exy_yms}
		     , ${mydt_atr_scop_ctt}
		     , ${at_dscr_yn}
		     , ${accs_tken_dscr_rsn_dtcd}
		     , ${at_dscr_yms}
		     , ${at_idi_no}
		     , ${mydt_tken_ctt}
		     , SYSTIMESTAMP
		     , ${시스템최종갱신식별자}
		     , TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF6')
		     )
		
	</statement>
	<statement name="insertUsrAcHisAll">
		INSERT INTO /*+ 이요한::/idv/IdvCtfACEbc/insertUsrAcHisAll */
		            INSTC.TBUBDC024
		     ( 마이데이터거래고유번호
		     , 마이데이터거래요청년월일
		     , 마이데이터토큰구분코드
		     , 마이데이터전송대상구분코드
		     , 마이데이터인증구분코드
		     , 마이데이터업권구분코드
		     , 마이데이터제공기관코드
		     , 마이데이터사업자기관코드
		     , 마이데이터클라이언트식별번호
		     , CI내용
		     , 고객식별자
		     , 고객관리번호
		     , 고객최초등록년월일
		     , 접근토큰유효기간초수
		     , 접근토큰만료일시
		     , 마이데이터권한영역내용
		     , 접근토큰폐기여부
		     , 접근토큰폐기사유구분코드
		     , 접근토큰폐기일시
		     , 접근토큰식별번호
		     , 마이데이터토큰내용
		     , 시스템최종갱신일시
		     , 시스템최종갱신식별자
		     , 시스템최종거래일시
		     )
		SELECT 마이데이터거래고유번호
		     , 마이데이터거래요청년월일
		     , 마이데이터토큰구분코드
		     , 마이데이터전송대상구분코드
		     , 마이데이터인증구분코드
		     , 마이데이터업권구분코드
		     , 마이데이터제공기관코드
		     , 마이데이터사업자기관코드
		     , 마이데이터클라이언트식별번호
		     , CI내용
		     , 고객식별자
		     , 고객관리번호
		     , 고객최초등록년월일
		     , 접근토큰유효기간초수
		     , 접근토큰만료일시
		     , 마이데이터권한영역내용
		     , ${at_dscr_yn}    /*  접근토큰폐기여부  */
		     ,  ${accs_tken_dscr_rsn_dtcd}  /*  접근토큰폐기사유구분코드  */
		     , CASE WHEN ${at_dscr_yn} = 'Y'
		            THEN TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
		            ELSE NULL
		        END  /* 접근토큰폐기일시 */
		     , 접근토큰식별번호
		     , 마이데이터토큰내용
			 , SYSTIMESTAMP
			 , ${시스템최종갱신식별자}
			 , TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF6')
		  FROM INSTC.TBUBDC023
		 WHERE CI내용 = ${ci_ctt}
		   AND 마이데이터제공기관코드 = ${mydt_ofer_ins_cd}
		   AND 마이데이터사업자기관코드 = ${mydt_bzm_ins_cd}
		   <!-- AND 마이데이터클라이언트식별번호 = ${mydt_clint_idi_no} -->
		
	</statement>
	<statement name="insertUsrAcHis">
		<![CDATA[
		INSERT INTO /*+ 이요한::/idv/IdvCtfACEbc/insertUsrAcHis */
		            INSTC.TBUBDC024
		     ( 마이데이터거래고유번호
		     , 마이데이터거래요청년월일
		     , 마이데이터전송대상구분코드
		     , 마이데이터인증구분코드
		     , 마이데이터업권구분코드
		     , 마이데이터제공기관코드
		     , 마이데이터사업자기관코드
		     , 마이데이터서비스명
		     , CI내용
		     , 고객식별자
		     , 고객관리번호
		     , 마이데이터토큰구분코드
		     , 접근토큰유효기간초수
		     , 접근토큰만료일시
		     , 마이데이터권한영역내용
		     , 접근토큰폐기여부
		     , 접근토큰폐기사유구분코드
		     , 접근토큰폐기일시
		     , 접근토큰식별번호
		     , 마이데이터토큰내용
		     , 시스템최종갱신일시
		     , 시스템최종갱신식별자
		     , 시스템최종거래일시
		     )
		SELECT 마이데이터거래고유번호
		     , 마이데이터거래요청년월일
		     , 마이데이터전송대상구분코드
		     , 마이데이터인증구분코드
		     , 마이데이터업권구분코드
		     , 마이데이터제공기관코드
		     , 마이데이터사업자기관코드
		     , 마이데이터서비스명
		     , CI내용
		     , 고객식별자
		     , 고객관리번호
		     , 마이데이터토큰구분코드
		     , 접근토큰유효기간초수
		     , 접근토큰만료일시
		     , 마이데이터권한영역내용
		     , 접근토큰폐기여부
		     , 접근토큰폐기사유구분코드
		     , 접근토큰폐기일시
		     , 접근토큰식별번호
		     , 마이데이터토큰내용
			 , SYSTIMESTAMP
			 , ${시스템최종갱신식별자}
			 , TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF6')
		  FROM INSTC.TBUBDC023
		 WHERE CI내용 = ${dmd_mydt_tr_uno}
		   AND 마이데이터제공기관코드 = ${dmd_mydt_tr_dmd_ymd}
		   AND 마이데이터사업자기관코드 = ${dmd_mydt_tr_dmd_ymd}
		   AND 마이데이터서비스명 = ${dmd_mydt_tr_dmd_ymd}
		]]>
	</statement>
</statements>