<?xml version="1.0" encoding="EUC-KR"?>
<statements>

    <!--  -->
    <statement name="retvBchVlnBas" qPath="[GCB_MODEL_업무공통] 2.시스템명세모델::06.배치컴포넌트::05.IT운영지원::04.배치검증::배치검증배치Job::DAO::배치검증배치Bdao::배치검증기본조회">
		<![CDATA[
			SELECT /*+ 위상규::/gcb/batch/itOpSpt/bchVln/bchVlnBchJob/BchVlnBch/retvBchVlnBas */ 
			       NVL(A.등록상태구분코드, 'X') 등록상태구분코드
			  FROM INSTC.TBGCBMB01 A 
			 WHERE A.어플리케이션구분코드   = ${어플리케이션구분코드}
			   AND A.배치작업검증대분류내용  = ${배치작업검증대분류내용}
			   AND A.배치작업검증중분류내용  = ${배치작업검증중분류내용}
			   AND A.배치작업검증소분류내용  = ${배치작업검증소분류내용}
			   AND A.배치작업검증분류일련번호 = ${배치작업검증분류일련번호}
			   AND A.배치작업검증일련번호 = (SELECT MAX(B.배치작업검증일련번호)
			                            FROM INSTC.TBGCBMB01 B
			                           WHERE B.어플리케이션구분코드 = A.어플리케이션구분코드
			                             AND B.배치작업검증대분류내용 = A.배치작업검증대분류내용
			                             AND B.배치작업검증중분류내용 = A.배치작업검증중분류내용
			                             AND B.배치작업검증소분류내용 = A.배치작업검증소분류내용
			                             AND B.배치작업검증분류일련번호 = A.배치작업검증분류일련번호)
		]]>
    </statement>

    <!--  -->
    <statement name="regtBchVlnHis" qPath="[GCB_MODEL_업무공통] 2.시스템명세모델::06.배치컴포넌트::05.IT운영지원::04.배치검증::배치검증배치Job::DAO::배치검증배치Bdao::배치검증내역등록">
		<![CDATA[
			INSERT /*+ 위상규::/gcb/batch/itOpSpt/bchVln/bchVlnBchJob/BchVlnBch/regtBchVlnHis */
			  INTO INSTC.TBGCBMB02
			(
			   어플리케이션구분코드
			 , 배치작업검증대분류내용
			 , 배치작업검증중분류내용
			 , 배치작업검증소분류내용
			 , 배치작업검증분류일련번호
			 , 생성년월일
			 , 배치작업검증내역일련번호
			 , 결제년월일
			 , 카드결제기관구분코드
			 , 카드결제방법구분코드
			 , 배치작업검증대상처리건수
			 , 배치작업검증대상처리금액
			 , 배치작업검증대상제외여부
			 , 시스템최종갱신일시
			 , 시스템최종갱신식별자
			 , 시스템최종거래일시
			)
			VALUES
			(
			  ${어플리케이션구분코드}
			 ,${배치작업검증대분류내용}
			 ,${배치작업검증중분류내용}
			 ,${배치작업검증소분류내용}
			 ,${배치작업검증분류일련번호}
			 ,${생성년월일}
			 ,(SELECT CASE WHEN MAX(배치작업검증내역일련번호1) = 0 THEN MAX(배치작업검증내역일련번호2)
			               WHEN MAX(배치작업검증내역일련번호1) <> 0 THEN MAX(배치작업검증내역일련번호1)
			           END 배치작업검증내역일련번호
			     FROM (SELECT NVL(MAX(A.배치작업검증내역일련번호), 0) 배치작업검증내역일련번호1
			                , 0 배치작업검증내역일련번호2
			             FROM INSTC.TBGCBMB02 A
			            WHERE 1 = 1
			              AND A.어플리케이션구분코드 = ${어플리케이션구분코드}
			              AND A.배치작업검증대분류내용 = ${배치작업검증대분류내용}
			              AND A.배치작업검증중분류내용 = ${배치작업검증중분류내용}
			              AND A.배치작업검증소분류내용 = ${배치작업검증소분류내용}
			              AND A.배치작업검증분류일련번호 = ${배치작업검증분류일련번호}
			              AND A.생성년월일 = ${생성년월일}
			              AND A.결제년월일 = DECODE(${결제년월일}, NULL, A.결제년월일, ${결제년월일})
			              AND A.카드결제기관구분코드 = DECODE(${카드결제기관구분코드}, NULL, A.카드결제기관구분코드, ${카드결제기관구분코드})
			              AND A.카드결제방법구분코드 = DECODE(${카드결제방법구분코드}, NULL, A.카드결제방법구분코드, ${카드결제방법구분코드})
			            UNION ALL
			           SELECT 0 배치작업검증내역일련번호1
			                , NVL(MAX(A.배치작업검증내역일련번호), 0) + 1 배치작업검증내역일련번호2
			             FROM INSTC.TBGCBMB02 A
			            WHERE 1 = 1
			              AND A.어플리케이션구분코드 = ${어플리케이션구분코드}
			              AND A.배치작업검증대분류내용 = ${배치작업검증대분류내용}
			              AND A.배치작업검증중분류내용 = ${배치작업검증중분류내용}
			              AND A.배치작업검증소분류내용 = ${배치작업검증소분류내용}
			              AND A.배치작업검증분류일련번호 = ${배치작업검증분류일련번호}
			              AND A.생성년월일 = ${생성년월일}))
			 ,${결제년월일}
			 ,${카드결제기관구분코드}
			 ,${카드결제방법구분코드}
			 ,${배치작업검증대상처리건수}
			 ,${배치작업검증대상처리금액}
			 ,${배치작업검증대상제외여부}
			 ,SYSTIMESTAMP
			 ,${시스템최종갱신식별자}
			 ,${시스템최종거래일시}
			)
		]]>
    </statement>

    <!--  -->
    <statement name="retvBchVlnHis" qPath="[GCB_MODEL_업무공통] 2.시스템명세모델::06.배치컴포넌트::05.IT운영지원::04.배치검증::배치검증배치Job::DAO::배치검증배치Bdao::배치검증내역조회">
		<![CDATA[
			SELECT /*+ 위상규::/gcb/batch/itOpSpt/bchVln/bchVlnBchJob/BchVlnBch/retvBchVlnHis */ 
			       A.어플리케이션구분코드
			     , A.배치작업검증대분류내용
			     , A.배치작업검증중분류내용
			     , A.배치작업검증소분류내용
			     , A.배치작업검증분류일련번호
			     , A.생성년월일
			     , A.결제년월일
			     , A.카드결제기관구분코드
			     , A.카드결제방법구분코드
			     , A.배치작업검증대상처리건수
			     , A.배치작업검증대상처리금액
			     , A.배치작업검증대상제외여부
			     , TO_CHAR(시스템최종갱신일시, 'YYYYMMDDHH24MISS') as 시스템최종갱신일시
			     , A.시스템최종갱신식별자
			     , A.시스템최종거래일시
			  FROM INSTC.TBGCBMB02 A 
			 WHERE A.어플리케이션구분코드   = ${어플리케이션구분코드}
			   AND A.배치작업검증대분류내용  = ${배치작업검증대분류내용}
			   AND A.배치작업검증중분류내용  = ${배치작업검증중분류내용}
			   AND A.배치작업검증소분류내용  = ${배치작업검증소분류내용}
			   AND A.배치작업검증분류일련번호 = ${배치작업검증분류일련번호}
			   AND A.생성년월일 = ${생성년월일}
			   AND A.결제년월일 = DECODE(${결제년월일}, NULL, A.결제년월일, ${결제년월일})
			   AND A.카드결제기관구분코드 = DECODE(${카드결제기관구분코드}, NULL, A.카드결제기관구분코드, ${카드결제기관구분코드})
			   AND A.카드결제방법구분코드 = DECODE(${카드결제방법구분코드}, NULL, A.카드결제방법구분코드, ${카드결제방법구분코드})
		]]>
    </statement>

    <!--  -->
    <statement name="delBchVlnHis" qPath="[GCB_MODEL_업무공통] 2.시스템명세모델::06.배치컴포넌트::05.IT운영지원::04.배치검증::배치검증배치Job::DAO::배치검증배치Bdao::배치검증내역삭제">
		<![CDATA[
			DELETE /*+ 위상규::/gcb/batch/itOpSpt/bchVln/bchVlnBchJob/BchVlnBch/delBchVlnHis */
			  FROM INSTC.TBGCBMB02  
			 WHERE 어플리케이션구분코드   = ${어플리케이션구분코드}
			   AND 배치작업검증대분류내용  = ${배치작업검증대분류내용}
			   AND 배치작업검증중분류내용  = ${배치작업검증중분류내용}
			   AND 배치작업검증소분류내용  = ${배치작업검증소분류내용}
			   AND 배치작업검증분류일련번호 = ${배치작업검증분류일련번호}
			   AND 생성년월일 = ${생성년월일}
			   AND 결제년월일 = DECODE(${결제년월일}, NULL, 결제년월일, ${결제년월일})
			   AND 카드결제기관구분코드 = DECODE(${카드결제기관구분코드}, NULL, 카드결제기관구분코드, ${카드결제기관구분코드})
			   AND 카드결제방법구분코드 = DECODE(${카드결제방법구분코드}, NULL, 카드결제방법구분코드, ${카드결제방법구분코드})
		]]>
    </statement>
</statements>
