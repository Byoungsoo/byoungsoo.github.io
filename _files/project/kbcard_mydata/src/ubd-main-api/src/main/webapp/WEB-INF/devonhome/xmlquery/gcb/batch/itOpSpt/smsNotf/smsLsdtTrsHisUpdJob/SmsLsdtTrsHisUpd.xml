<?xml version="1.0" encoding="EUC-KR"?>
<statements>

    <!--  -->
    <statement name="uptSmsLsdtTrsHis" qPath="[GCB_MODEL_업무공통] 2.시스템명세모델::06.배치컴포넌트::05.IT운영지원::02.SMS통보::SMS전일자전송내역갱신Job::DAO::SMS전일자전송내역갱신Bdao::SMS전일자전송내역수정">
		<![CDATA[
			UPDATE /*+ 위상규::/gcb/batch/itOpSpt/smsNotf/smsLsdtTrsHisUpdJob/SmsLsdtTrsHisUpd/uptSmsLsdtTrsHis */ 
			       INSTC.TBGCBSM03 A
			   SET
			     ( A.최종SMS전송일시
			     , A.최종일자SMS전송건수
			     , A.최종SMS전송거래유형구분코드
			     , A.최종SMS전송거래코드
			     , A.최종SMS전송배치작업명
			     , A.최종SMS전송프로그램명
			     , A.최종SMS전송메시지내용
			     , A.시스템최종갱신일시
			     , A.시스템최종갱신식별자
			     , A.시스템최종거래일시 ) = (SELECT NVL(MAX(B.IT운영SMS전송년월일 || SUBSTR(B.IT운영SMS전송시각, 1, 6)), A.최종SMS전송일시) 최종SMS전송일시
			                                , CASE WHEN COUNT(*) = 0 THEN A.최종일자SMS전송건수
			                                                         ELSE COUNT(*)
			                                   END 최종일자SMS전송건수
			                                , NVL(SUBSTR(MAX(B.IT운영SMS전송시각 || NVL(B.SMS전송거래유형구분코드,' ')), 13), A.최종SMS전송거래유형구분코드) 최종SMS전송거래유형구분코드
			                                , NVL(SUBSTR(MAX(B.IT운영SMS전송시각 || NVL(B.SMS전송거래코드,' ')), 13), A.최종SMS전송거래코드) 최종SMS전송거래코드
			                                , NVL(SUBSTR(MAX(B.IT운영SMS전송시각 || NVL(B.SMS전송배치작업명,' ')), 13), A.최종SMS전송배치작업명) 최종SMS전송배치작업명
			                                , NVL(SUBSTR(MAX(B.IT운영SMS전송시각 || NVL(B.SMS전송프로그램명,' ')), 13), A.최종SMS전송프로그램명) 최종SMS전송프로그램명
			                                , NVL(SUBSTR(MAX(B.IT운영SMS전송시각 || NVL(B.SMS전송메시지내용,' ')), 13), A.최종SMS전송메시지내용) 최종SMS전송메시지내용
			                                , SYSTIMESTAMP 시스템최종갱신일시
			                                , NVL(SUBSTR(MAX(B.IT운영SMS전송시각 || B.시스템최종갱신식별자), 13), A.시스템최종갱신식별자) 시스템최종갱신식별자
			                                , NVL(SUBSTR(MAX(B.IT운영SMS전송시각 || B.시스템최종거래일시), 13), A.시스템최종거래일시) 시스템최종거래일시
			                             FROM INSTC.TBGCBSM04 B
			                            WHERE B.IT운영SMS전송년월일 = TO_CHAR(SYSDATE - 1, 'YYYYMMDD')
			                              AND B.어플리케이션코드 = A.어플리케이션코드
			                              AND B.IT운영SMS일련번호 = A.IT운영SMS일련번호
			                              AND B.IT운영SMS부가일련번호 = A.IT운영SMS부가일련번호
			                              AND B.IT운영SMS전송시각 NOT LIKE 'E%')
			 WHERE (어플리케이션코드, IT운영SMS일련번호, IT운영SMS부가일련번호) IN (SELECT 어플리케이션코드
			                                                               , IT운영SMS일련번호
			                                                               , IT운영SMS부가일련번호
			                                                            FROM INSTC.TBGCBSM04 C
			                                                           WHERE C.IT운영SMS전송년월일 = TO_CHAR(SYSDATE - 1, 'YYYYMMDD')
			                                                             AND C.IT운영SMS전송시각 NOT LIKE 'E%')
		]]>
    </statement>
</statements>
