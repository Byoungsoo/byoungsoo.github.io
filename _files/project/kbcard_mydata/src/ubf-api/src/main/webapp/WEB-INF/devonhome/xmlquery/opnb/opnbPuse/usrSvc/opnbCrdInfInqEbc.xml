<?xml version="1.0" encoding="EUC-KR"?>
<statements>

	<!-- 카드목록 등록  -->
	<statement name="insertCrdCtg">
		<![CDATA[
		MERGE /* 박건우::/opnb/opnbPuse/usrSvc/opnbCrdInfInqEbc/insertCrdCtg */
		 INTO INSTC.TBUBFS020
		USING DUAL
		   ON (오픈뱅킹회원금융회사코드 = ${오픈뱅킹회원금융회사코드}
		  AND 오픈뱅킹사용자고유번호     = ${오픈뱅킹사용자고유번호}
		  AND 오픈뱅킹카드식별자          = ${오픈뱅킹카드식별자})
		 WHEN MATCHED THEN UPDATE SET
		            오픈뱅킹마스킹카드번호  = NVL(${오픈뱅킹마스킹카드번호}, 오픈뱅킹마스킹카드번호)
		     , 카드상품명 		    = NVL(${카드상품명}, 카드상품명)
		     , 가족카드여부 		= NVL(${가족카드여부}, 가족카드여부)
		     , 오픈뱅킹카드구분코드 	= NVL(${오픈뱅킹카드구분코드}, 오픈뱅킹카드구분코드)
		     , 결제은행코드 		= NVL(${결제은행코드}, 결제은행코드)
		     , 카드결제계좌번호          = NVL(${카드결제계좌번호}, 카드결제계좌번호)
		     , 마스킹카드결제계좌번호  = NVL(${마스킹카드결제계좌번호}, 마스킹카드결제계좌번호)
		     , 카드발급년월일  	    = NVL(${카드발급년월일}, 카드발급년월일)
		     , 시스템최종갱신일시    = SYSTIMESTAMP
		     , 시스템최종갱신식별자 = ${시스템최종갱신식별자}
		     , 시스템최종거래일시    = ${시스템최종거래일시}
		 WHEN NOT MATCHED THEN INSERT 
		     ( 오픈뱅킹회원금융회사코드 
		     , 오픈뱅킹사용자고유번호
		     , 오픈뱅킹카드식별자
		     , 오픈뱅킹개설기관코드
		     , 오픈뱅킹마스킹카드번호
		     , 카드상품명
		     , 가족카드여부
		     , 오픈뱅킹카드구분코드
		     , 결제은행코드
		     , 카드결제계좌번호
		     , 마스킹카드결제계좌번호
		     , 카드발급년월일
		     , 시스템최초생성일시
		     , 시스템최초생성식별자
		     , 시스템최종갱신일시
		     , 시스템최종갱신식별자
		     , 시스템최종거래일시 )
		VALUES 
		     ( ${오픈뱅킹회원금융회사코드}
		     , ${오픈뱅킹사용자고유번호}
		     , ${오픈뱅킹카드식별자}
		     , ${오픈뱅킹개설기관코드}
		     , ${오픈뱅킹마스킹카드번호}
		     , ${카드상품명}
		     , ${가족카드여부}
		     , ${오픈뱅킹카드구분코드}
		     , ${결제은행코드}
		     , ${카드결제계좌번호}
		     , ${마스킹카드결제계좌번호}
		     , ${카드발급년월일}
		     , SYSTIMESTAMP
		     , ${시스템최초생성식별자}
		     , SYSTIMESTAMP
		     , ${시스템최종갱신식별자}
		     , ${시스템최종거래일시} )
		]]>
	</statement>

 	<!-- 카드기본정보 수정 -->
    <statement name="updateCrdBasInf">
		<![CDATA[
			UPDATE /*+ 박건우::/opnb/opnbPuse/usrSvc/opnbCrdInfInqEbc/updateCrdBasInf */ 
                   INSTC.TBUBFS020        /* UBF오픈뱅킹카드정보기본 */
               SET 오픈뱅킹카드구분코드        = NVL(${오픈뱅킹카드구분코드} , 오픈뱅킹카드구분코드)
                 , 결제은행코드                  = NVL(${결제은행코드} , 결제은행코드)
                 , 카드결제계좌번호             = NVL(${카드결제계좌번호} , 카드결제계좌번호)
                 , 마스킹카드결제계좌번호     = NVL(${마스킹카드결제계좌번호} , 마스킹카드결제계좌번호)
                 , 카드발급년월일               = NVL(${카드발급년월일} , 카드발급년월일)
                 , 시스템최종갱신일시          = SYSTIMESTAMP      
                 , 시스템최종갱신식별자        = ${시스템최종갱신식별자}        
                 , 시스템최종거래일시          = ${시스템최종거래일시}
             WHERE 오픈뱅킹회원금융회사코드   = ${오픈뱅킹회원금융회사코드}
               AND 오픈뱅킹카드식별자          = ${오픈뱅킹카드식별자}
               
		]]>
    </statement>
    
    <!-- 카드청구기본정보 등록  -->
	<statement name="insertCrdBilBasInf">
		<![CDATA[
		MERGE /* 박건우::/opnb/opnbPuse/usrSvc/opnbCrdInfInqEbc/insertCrdBilBasInf */
		 INTO INSTC.TBUBFS021
		USING DUAL
		   ON (오픈뱅킹회원금융회사코드 = ${오픈뱅킹회원금융회사코드}
		  AND 오픈뱅킹사용자고유번호     = ${오픈뱅킹사용자고유번호}
		  AND 청구년월                      = ${청구년월}
		  AND 카드결제일련번호            = ${카드결제일련번호}
		  AND 오픈뱅킹카드식별자          = ${오픈뱅킹카드식별자})
		 WHEN MATCHED THEN UPDATE SET
		            청구금액                    = NVL(${청구금액}, 청구금액)
		     , 오픈뱅킹카드결제일 	= NVL(${오픈뱅킹카드결제일}, 오픈뱅킹카드결제일)
		     , 실제결제년월일 		= NVL(${실제결제년월일}, 실제결제년월일)
		     , 오픈뱅킹카드구분코드 	= NVL(${오픈뱅킹카드구분코드}, 오픈뱅킹카드구분코드)
		     , 시스템최종갱신일시    = SYSTIMESTAMP
		     , 시스템최종갱신식별자 = ${시스템최종갱신식별자}
		     , 시스템최종거래일시    = ${시스템최종거래일시}
		 WHEN NOT MATCHED THEN INSERT 
		     ( 오픈뱅킹회원금융회사코드 
		     , 오픈뱅킹사용자고유번호
		     , 청구년월
		     , 카드결제일련번호
		     , 오픈뱅킹카드식별자
		     , 오픈뱅킹개설기관코드
		     , 청구금액
		     , 오픈뱅킹카드결제일
		     , 실제결제년월일
		     , 오픈뱅킹카드구분코드
		     , 시스템최초생성일시
		     , 시스템최초생성식별자
		     , 시스템최종갱신일시
		     , 시스템최종갱신식별자
		     , 시스템최종거래일시 )
		VALUES 
		     ( ${오픈뱅킹회원금융회사코드}
		     , ${오픈뱅킹사용자고유번호}
		     , ${청구년월}
		     , ${카드결제일련번호}
		     , ${오픈뱅킹카드식별자}
		     , ${오픈뱅킹개설기관코드}
		     , ${청구금액}
		     , ${오픈뱅킹카드결제일}
		     , ${실제결제년월일}
		     , ${오픈뱅킹카드구분코드}
		     , SYSTIMESTAMP
		     , ${시스템최초생성식별자}
		     , SYSTIMESTAMP
		     , ${시스템최종갱신식별자}
		     , ${시스템최종거래일시} )
		]]>
	</statement>
	
	<!-- 오픈뱅킹카드청구상세일련번호채번조회 -->
    <statement name="selectOpnbCrdBilDtlSnoBbr">
		<![CDATA[
			SELECT /*+ 박건우::/opnb/opnbPuse/usrSvc/opnbCrdInfInqEbc/selectOpnbCrdBilDtlSnoBbr */
                   INSTC.SQ_TBUBFS022_01.NEXTVAL AS 오픈뱅킹카드청구상세일련번호
              FROM DUAL 
		]]>
    </statement>
    
    <!-- 카드청구상세정보 등록 -->
    <statement name="insertCrdBilDtlInf">
		<![CDATA[
			INSERT /*+ 박건우::/opnb/opnbPuse/usrSvc/opnbCrdInfInqEbc/insertCrdBilDtlInf */
	          INTO INSTC.TBUBFS022        /* UBF오픈뱅킹카드청구상세 */
		    	 (
		 	              오픈뱅킹회원금융회사코드 
		          , 오픈뱅킹사용자고유번호
		          , 청구년월
		          , 카드결제일련번호
		          , 오픈뱅킹카드청구상세거래일시
		          , 오픈뱅킹카드청구상세일련번호
		          , 오픈뱅킹개설기관코드
		          , 오픈뱅킹카드식별번호
		          , 카드사용년월일
		          , 오픈뱅킹카드사용시각
		          , 카드이용금액
		          , 오픈뱅킹마스킹가맹점명
		          , 신용판매거래수수료
		          , 오픈뱅킹카드상품구분코드
                  , 시스템최초생성식별자 
                  , 시스템최초생성일시
                  , 시스템최종갱신식별자
                  , 시스템최종갱신일시 
                  , 시스템최종거래일시
                  
			    )
			     VALUES
			    (
			      ${오픈뱅킹회원금융회사코드} 
                , ${오픈뱅킹사용자고유번호} 
                , ${청구년월} 
                , ${카드결제일련번호} 
                , ${오픈뱅킹카드청구상세거래일시} 
                , ${오픈뱅킹카드청구상세일련번호}
                , ${오픈뱅킹개설기관코드} 
                , ${오픈뱅킹카드식별번호} 
                , ${카드사용년월일}
                , ${오픈뱅킹카드사용시각}
                , ${카드이용금액}
                , ${오픈뱅킹마스킹가맹점명}
                , ${신용판매거래수수료}
                , ${오픈뱅킹카드상품구분코드}
                , ${시스템최초생성식별자} 
                , SYSTIMESTAMP
                , ${시스템최종갱신식별자} 
                , SYSTIMESTAMP
                , ${시스템최종거래일시}	
			    )
		]]>
    </statement>
    
    
     

</statements>
