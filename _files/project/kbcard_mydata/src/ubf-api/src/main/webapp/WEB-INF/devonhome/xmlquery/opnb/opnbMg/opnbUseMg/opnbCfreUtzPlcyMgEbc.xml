<?xml version="1.0" encoding="EUC-KR"?>
<statements>


    <!-- 오픈뱅킹무료이용정책등록 -->
    <statement name="insertOpnbCfreUtzPlcyBas">
		<![CDATA[
	
			INSERT /*+ 정영훈::/opnb/opnbMg/opnbUseMg/opnbCfreUtzPlcyMgEbc/insertOpnbCfreUtzPlcyBas */
	          INTO INSTC.TBUBFS013        /* UBF오픈뱅킹무료이용정책기본 */
		    	 (
		 	           오픈뱅킹무료정책일련번호
                , 채널세부업무구분코드
                , 오픈뱅킹무료정책명
                , 오픈뱅킹무료이용유형구분코드
                , 오픈뱅킹무료정책시작일시
                , 오픈뱅킹무료정책종료일시
                , 오픈뱅킹혜택구분코드
                , 오픈뱅킹혜택대상내용
                , 오픈뱅킹무제한여부
                , 오픈뱅킹기간구분코드
                , 오픈뱅킹무료제공건수
                , 오픈뱅킹타시스템연계여부
                , 시스템최초생성일시
                , 시스템최초생성식별자
                , 시스템최종갱신일시
                , 시스템최종갱신식별자
                , 시스템최종거래일시			
			    )
			     VALUES
			    (
			      ${오픈뱅킹무료정책일련번호}      
                , ${채널세부업무구분코드}
                , ${오픈뱅킹무료정책명}
                , ${오픈뱅킹무료이용유형구분코드}
                , ${오픈뱅킹무료정책시작일시}
                , ${오픈뱅킹무료정책종료일시}
                , ${오픈뱅킹혜택구분코드}
                , ${오픈뱅킹혜택대상내용}
                , ${오픈뱅킹무제한여부}
                , ${오픈뱅킹기간구분코드}
                , ${오픈뱅킹무료제공건수}
                , ${오픈뱅킹타시스템연계여부}
                , SYSTIMESTAMP
                , ${시스템최초생성식별자}
                , SYSTIMESTAMP
                , ${시스템최종갱신식별자}
                , ${시스템최종거래일시}		                      	
			)
			
			
		]]>
    </statement>

    <!-- 오픈뱅킹무료정책일련번호채번조회 -->
    <statement name="selectOpnbCfrePlcySnoNbr">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbMg/opnbUseMg/opnbCfreUtzPlcyMgEbc/selectOpnbCfrePlcySnoNbr */ 
			       NVL(MAX(오픈뱅킹무료정책일련번호),0) + 1  AS  오픈뱅킹무료정책일련번호
              FROM INSTC.TBUBFS013      /* UBF오픈뱅킹기관거래내역 */
		]]>
    </statement>

   <!-- 오픈뱅킹무료정책일련번호조회 -->
    <statement name="selectOpnbChnPrCfrePlcySno">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbMg/opnbUseMg/opnbCfreUtzPlcyMgEbc/selectOpnbChnPrCfrePlcySno */ 
			            오픈뱅킹무료정책일련번호
			     , 오픈뱅킹무료제공건수
			     , 오픈뱅킹무료정책시작일시
			     , 오픈뱅킹무료정책종료일시
                 , 오픈뱅킹기간구분코드
                 , 채널세부업무구분코드
              FROM INSTC.TBUBFS013    /* UBF오픈뱅킹기관거래내역 */
             WHERE 채널세부업무구분코드         IN (${채널세부업무구분코드} ,'26')
               AND 오픈뱅킹무제한여부 = 'N'
               AND ${거래일시} BETWEEN 오픈뱅킹무료정책시작일시  AND 오픈뱅킹무료정책종료일시
               AND 오픈뱅킹무료정책일련번호 = (SELECT MIN(오픈뱅킹무료정책일련번호)			     
                                          FROM INSTC.TBUBFS013 A /* UBF오픈뱅킹기관거래내역 */
                                         WHERE A.채널세부업무구분코드    IN (${채널세부업무구분코드} ,'26')
                                           AND A.오픈뱅킹무제한여부 = 'N'
                                           AND ${거래일시} BETWEEN 오픈뱅킹무료정책시작일시  AND 오픈뱅킹무료정책종료일시
                                           {#AND}
                                         )
		]]>
		
		<append where="false" condition="${COND}.EQ,NOTIN" id="#AND">
            <![CDATA[
                AND A.오픈뱅킹무료정책일련번호 NOT IN (${오픈뱅킹무료정책일련번호:String:in})
            ]]>
        </append>
		
    </statement>

 		<!-- 오픈뱅킹무료이용정책목록조회 -->
    <statement name="selectCfreUtzPlcyCtg">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbMg/opnbUseMg/opnbCfreUtzPlcyMgEbc/selectCfreUtzPlcyCtg */ 
			            오픈뱅킹무료정책일련번호
			     , 채널세부업무구분코드
			     , 오픈뱅킹무료정책명
			     , 오픈뱅킹무료제공건수
			     , 오픈뱅킹무료정책시작일시
			     , 오픈뱅킹무료정책종료일시        
              FROM INSTC.TBUBFS013    /* UBF오픈뱅킹기관거래내역 */
             WHERE 채널세부업무구분코드  = NVL(${채널세부업무구분코드} , 채널세부업무구분코드)
                   {#AND}
		]]>
		
		<append where="false" condition="${COND}.EQ,CURYN" id="#AND">
            <![CDATA[
               AND ${거래일시} BETWEEN  오픈뱅킹무료정책시작일시 AND 오픈뱅킹무료정책종료일시 
            ]]>
        </append>
		
    </statement>
    
    	<!-- 오픈뱅킹무료이용정책상세조회 -->
    <statement name="selectCfreUtzPlcyDtl">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbMg/opnbUseMg/opnbCfreUtzPlcyMgEbc/selectCfreUtzPlcyDtl */ 
			           채널세부업무구분코드 
			    , 오픈뱅킹무료정책명 
			    , 오픈뱅킹무료이용유형구분코드
			    , 오픈뱅킹무료정책시작일시
			    , 오픈뱅킹무료정책종료일시
			    , 오픈뱅킹혜택구분코드
			    , 오픈뱅킹혜택대상내용
			    , 오픈뱅킹무제한여부
			    , 오픈뱅킹기간구분코드
			    , 오픈뱅킹무료제공건수
			    , 오픈뱅킹타시스템연계여부        
              FROM INSTC.TBUBFS013    /* UBF오픈뱅킹기관거래내역 */
             WHERE 오픈뱅킹무료정책일련번호   = ${오픈뱅킹무료정책일련번호}
             
		]]>
    </statement>
    
    	<!-- 오픈뱅킹유효무료정책목록조회 -->
    <statement name="selectOpnbVldCfrePlcyCtg">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbMg/opnbUseMg/opnbCfreUtzPlcyMgEbc/selectOpnbVldCfrePlcyCtg */ 
			            오픈뱅킹무료정책일련번호
			     , 오픈뱅킹무료제공건수
			     , 오픈뱅킹기간구분코드
			     , 채널세부업무구분코드
              FROM INSTC.TBUBFS013    /* UBF오픈뱅킹기관거래내역 */
             WHERE 채널세부업무구분코드  IN  (${채널세부업무구분코드} , '26' )
               AND 오픈뱅킹무제한여부 = NVL(${오픈뱅킹무제한여부}, 오픈뱅킹무제한여부 )
               AND ${거래일시} BETWEEN 오픈뱅킹무료정책시작일시 AND 오픈뱅킹무료정책종료일시 
		]]>
    </statement>
    
      <!-- 오픈뱅킹무료이용정책등록 -->
    <statement name="updateCfreUtzPlcy">
		<![CDATA[
		
			UPDATE /*+ 정영훈::/opnb/opnbMg/opnbUseMg/opnbCfreUtzPlcyMgEbc/updateCfreUtzPlcy */ 
                   INSTC.TBUBFS013        /* UBF오픈뱅킹무료정책 */
               SET 채널세부업무구분코드            = NVL(${채널세부업무구분코드},채널세부업무구분코드)
                 , 오픈뱅킹무료정책명              = NVL(${오픈뱅킹무료정책명},오픈뱅킹무료정책명)
                 , 오픈뱅킹무료이용유형구분코드  = NVL(${오픈뱅킹무료이용유형구분코드},오픈뱅킹무료이용유형구분코드)
                 , 오픈뱅킹무료정책시작일시 	= NVL(${오픈뱅킹무료정책시작일시},오픈뱅킹무료정책시작일시)
                 , 오픈뱅킹무료정책종료일시 	= NVL(${오픈뱅킹무료정책종료일시},오픈뱅킹무료정책종료일시)
                 , 오픈뱅킹혜택구분코드 	    = NVL(${오픈뱅킹혜택구분코드},오픈뱅킹혜택구분코드)
                 , 오픈뱅킹혜택대상내용 	    = NVL(${오픈뱅킹혜택대상내용},오픈뱅킹혜택대상내용)
                 , 오픈뱅킹무제한여부 	    = NVL(${오픈뱅킹무제한여부},오픈뱅킹무제한여부)
                 , 오픈뱅킹기간구분코드 	    = NVL(${오픈뱅킹기간구분코드},오픈뱅킹기간구분코드)
                 , 오픈뱅킹무료제공건수 	    = NVL(${오픈뱅킹무료제공건수},오픈뱅킹무료제공건수)
                 , 오픈뱅킹타시스템연계여부 	= NVL(${오픈뱅킹타시스템연계여부},오픈뱅킹타시스템연계여부)
                 , 시스템최종갱신일시              = SYSTIMESTAMP         
                 , 시스템최종갱신식별자            = ${시스템최종갱신식별자}        
                 , 시스템최종거래일시              = ${시스템최종거래일시}        
             WHERE 오픈뱅킹무료정책일련번호       = ${오픈뱅킹무료정책일련번호}
	
		]]>
    </statement>
    
    	<!-- 오픈뱅킹무제한거래대상정책조회 -->
    <statement name="selectOpnbNbRccTrTgPlcy">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbMg/opnbUseMg/opnbCfreUtzPlcyMgEbc/selectOpnbNbRccTrTgPlcy */ 
			           오픈뱅킹무료정책일련번호
                , 오픈뱅킹무료정책시작일시
                , 오픈뱅킹무료정책종료일시
                , 채널세부업무구분코드
                , 오픈뱅킹무료제공건수
             FROM INSTC.TBUBFS013                                           
            WHERE 채널세부업무구분코드   IN (${채널세부업무구분코드} , '26')
              AND 오픈뱅킹무제한여부 = 'Y'
              AND ${거래일시} BETWEEN 오픈뱅킹무료정책시작일시 AND 오픈뱅킹무료정책종료일시
              AND ROWNUM = 1
		]]>
    </statement>    

</statements>
