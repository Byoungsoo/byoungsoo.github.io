<?xml version="1.0" encoding="EUC-KR"?>
<statements>
	<!--  AccessToken 조회 -->
	<statement name="selectAccessToken">
		<![CDATA[
		SELECT /*+ MS05940::/opnb/apiCllg/kftcApi/opnbApiEbc/selectAccessToken */
		            오픈뱅킹토큰일련번호
		     , 오픈뱅킹접근토큰내용
		     , 오픈뱅킹토큰발급일시
		     , 오픈뱅킹토큰만료일시
		     , 오픈뱅킹토큰범위구분코드
		     , 오픈뱅킹토큰최종여부
		     , 오픈뱅킹이용기관코드
		  FROM INSTC.TBUBFS015
		 WHERE 오픈뱅킹토큰최종여부 = ${오픈뱅킹토큰최종여부}
		   AND 오픈뱅킹토큰범위구분코드 = ${오픈뱅킹토큰범위구분코드}
		   AND TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')  < 오픈뱅킹토큰만료일시		   
		   AND ROWNUM = 1
		 ORDER BY 오픈뱅킹토큰일련번호 DESC
		]]>
	</statement>
	
	<statement name="updateAccessToken">
		<![CDATA[
		 UPDATE /* MS05940::/opnb/apiCllg/kftcApi/opnbApiEbc/updateAccessToken */
		  INSTC.TBUBFS015 A SET 
		       A.오픈뱅킹토큰최종여부 = 'N'
		     , A.시스템최종갱신일시 = SYSTIMESTAMP
		     , A.시스템최종갱신식별자 = ${시스템최종갱신식별자}
		     , A.시스템최종거래일시 = ${시스템최종거래일시}
		 WHERE 오픈뱅킹토큰최종여부 = 'Y'
		   AND 오픈뱅킹토큰범위구분코드 = ${오픈뱅킹토큰범위구분코드}
		]]>
	</statement>	
	
	<!-- AccessToken 등록  -->
	<statement name="insertAccessToken">
		<![CDATA[
		INSERT /* MS05940::/opnb/apiCllg/kftcApi/opnbApiEbc/insertAccessToken */
		  INTO INSTC.TBUBFS015 A         
		     ( 오픈뱅킹토큰일련번호 
		     , 오픈뱅킹접근토큰내용
		     , 오픈뱅킹토큰발급일시
		     , 오픈뱅킹토큰만료일시
		     , 오픈뱅킹토큰범위구분코드
		     , 오픈뱅킹이용기관코드
		     , 오픈뱅킹토큰최종여부
		     , 시스템최초생성일시
		     , 시스템최초생성식별자
		     , 시스템최종갱신일시
		     , 시스템최종갱신식별자
		     , 시스템최종거래일시 )
		VALUES 
		     ( INSTC.SQ_TBUBFS015_01.NEXTVAL
		     , ${오픈뱅킹접근토큰내용}
		     , ${오픈뱅킹토큰발급일시}
		     , ${오픈뱅킹토큰만료일시}
		     , ${오픈뱅킹토큰범위구분코드}
		     , ${오픈뱅킹이용기관코드}
		     , ${오픈뱅킹토큰최종여부}
		     , SYSTIMESTAMP
		     , ${시스템최초생성식별자}
		     , SYSTIMESTAMP
		     , ${시스템최종갱신식별자}
		     , ${시스템최종거래일시} )
		]]>
	</statement>

	<!-- API정보 조회  -->
	<statement name="selectAPIInf">
		<![CDATA[
        SELECT /*+ MS05940::/opnb/apiCllg/kftcApi/opnbApiEbc/selectAPIInf */
               A.오픈뱅킹URL일련번호
		     , A.오픈뱅킹API관리구분코드
		     , A.오픈뱅킹수수료대상여부
		     , A.오픈뱅킹API명
		     , ${APIGW도메인} || A.오픈뱅킹URL내용 AS 오픈뱅킹URL내용
		     <!-- , A.오픈뱅킹URL내용 --> 
		     , DECODE(A.오픈API타입구분코드, '01', 'GET', '02', 'POST', NULL) AS 오픈API타입구분
		     , NVL(B.오픈뱅킹이용기관수수료, 0) AS 오픈뱅킹이용기관수수료
		     , DECODE(A.오픈뱅킹URL일련번호, 1, 'N', 2, 'N', 'Y') AS 오픈뱅킹API콘텐츠JSON유형
		  FROM INSTC.TBUBFS014 A
		     , INSTC.TBUBFS024 B
		 WHERE 1=1
           AND A.오픈뱅킹API관리구분코드 = B.오픈뱅킹API관리구분코드(+)
           AND A.오픈뱅킹URL일련번호 = ${오픈뱅킹URL일련번호}
		]]>
	</statement>
	
	<!-- API정보 조회  -->
	<statement name="selectAPIInfList">
		<![CDATA[
        SELECT /*+ MS05940::/opnb/apiCllg/kftcApi/opnbApiEbc/selectAPIInfList */
               A.오픈뱅킹URL일련번호
		     , A.오픈뱅킹API관리구분코드
		     , A.오픈뱅킹수수료대상여부
		     , A.오픈뱅킹API명
		     , ${APIGW도메인} || A.오픈뱅킹URL내용 AS 오픈뱅킹URL내용
		     /* , A.오픈뱅킹URL내용 */
		     , DECODE(A.오픈API타입구분코드, '01', 'GET', '02', 'POST', NULL) AS 오픈API타입구분
		     , NVL(B.오픈뱅킹이용기관수수료, 0) AS 오픈뱅킹이용기관수수료
		     , DECODE(A.오픈뱅킹URL일련번호, 1, 'N', 2, 'N', 'Y') AS 오픈뱅킹API콘텐츠JSON유형
		  FROM INSTC.TBUBFS014 A
		     , INSTC.TBUBFS024 B
		 WHERE 1=1
           AND A.오픈뱅킹API관리구분코드 = B.오픈뱅킹API관리구분코드(+)
		]]>
	</statement>
	
	<!-- API호출이력등록 -->
	<statement name="insertAPICallPhs">
		<![CDATA[ 
		INSERT /*+ MS05940::/opnb/apiCllg/kftcApi/opnbApiEbc/insertAPICallPhs */
		  INTO INSTC.TBUBFS008 
		     ( 오픈뱅킹전문거래년월일
		     , 오픈뱅킹URL일련번호
		     , 오픈뱅킹API거래로그일련번호
		     , 오픈뱅킹API거래고유번호
		     , 참가기관거래고유번호
		     , 채널세부업무구분코드
		     , 오픈뱅킹금융기관코드
		     , 오픈뱅킹사용자고유번호 
		     , 오픈뱅킹API응답구분코드
		     , 오픈뱅킹API응답메시지내용
		     , 대외기관전문송신일시
		     , 전문응답일시
		     , 오픈뱅킹응답금융기관코드
		     , 오픈뱅킹참가기관응답구분코드
		     , 오픈뱅킹참가기관응답메시지내용 
		     , 오픈뱅킹입력전문내용
		     , 오픈뱅킹출력전문내용
		     , 오픈뱅킹이용기관수수료
		     , 오픈뱅킹수수료대상여부
		     , 시스템최초생성일시
		     , 시스템최초생성식별자
		     , 시스템최종갱신일시
		     , 시스템최종갱신식별자
		     , 시스템최종거래일시 )
		VALUES (
		       ${오픈뱅킹전문거래년월일}
		     , ${오픈뱅킹URL일련번호}
		     , INSTC.SQ_TBUBFS008_01.NEXTVAL
		     , ${오픈뱅킹API거래고유번호}
		     , ${참가기관거래고유번호}
		     , ${채널세부업무구분코드}
		     , ${오픈뱅킹금융기관코드}
		     , ${오픈뱅킹사용자고유번호}
		     , ${오픈뱅킹API응답구분코드}
		     , ${오픈뱅킹API응답메시지내용}
		     , ${대외기관전문송신일시}
		     , ${전문응답일시}
		     , ${오픈뱅킹응답금융기관코드}
		     , ${오픈뱅킹참가기관응답구분코드}
		     , ${오픈뱅킹참가기관응답메시지내용}
		     , ${오픈뱅킹입력전문내용}
		     , ${오픈뱅킹출력전문내용}
		     , ${오픈뱅킹이용기관수수료}
		     , ${오픈뱅킹수수료대상여부}
		     , SYSTIMESTAMP
		     , ${시스템최초생성식별자}
		     , SYSTIMESTAMP
		     , ${시스템최종갱신식별자}
		     , ${시스템최종거래일시} )
		]]>
	</statement>
	 
	<!-- 고객CI내용조회 -->
	<statement name="selectCiCtt">
		<![CDATA[ 
		SELECT /*+ MS05940::/opnb/apiCllg/kftcApi/opnbApiEbc/selectCiCtt */
		       A.CI내용
		  FROM INSTC.TBUBFS001 A
		 WHERE A.오픈뱅킹사용자고유번호 = ${오픈뱅킹사용자고유번호}
		
	 
		]]>
	</statement>
	
	<statement name="selectAPICallPhsSeq">
		<![CDATA[ 
		SELECT /*+ MS05940::/opnb/apiCllg/kftcApi/opnbApiEbc/selectAPICallPhsSeq */
		       INSTC.SQ_TBUBFS008_01.NEXTVAL AS 오픈뱅킹API거래로그일련번호
		     , ${시스템최초생성식별자} AS 시스템최초생성식별자
		     , ${시스템최종갱신식별자} AS 시스템최종갱신식별자
		     , ${시스템최종거래일시} AS 시스템최종거래일시
		  FROM DUAL
		]]>
	</statement>
</statements>