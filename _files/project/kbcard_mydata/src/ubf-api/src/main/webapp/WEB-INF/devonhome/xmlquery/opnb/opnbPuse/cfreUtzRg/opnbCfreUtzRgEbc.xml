<?xml version="1.0" encoding="EUC-KR"?>
<statements>


    <!-- 오픈뱅킹고객별무료거래내역등록 -->
    
    <statement name="insertOpnbCstPrCfreTnhs">
		<![CDATA[
			INSERT /*+ 정영훈::/opnb/opnbPuse/cfreUtzRg/opnbCfreUtzRgEbc/insertOpnbCstPrCfreTnhs */
	          INTO INSTC.TBUBFS012        /* UBF오픈뱅킹고객별무료거래내역 */
		    	 (
		 	           오픈뱅킹사용자고유번호
                , 오픈뱅킹무료정책일련번호
                , 채널세부업무구분코드
                , 오픈뱅킹무료거래일련번호 
                , 오픈뱅킹무료거래건수
                , 오픈뱅킹무료건수갱신일시
                , 적용시작일시
                , 적용종료일시
                , 오픈뱅킹전문거래년월일 
                , 참가기관출금거래고유번호 
                , 참가기관입금거래고유번호 
                , 시스템최초생성일시
                , 시스템최초생성식별자
                , 시스템최종갱신일시
                , 시스템최종갱신식별자
                , 시스템최종거래일시			
			    )
			     VALUES
			    (
			      ${오픈뱅킹사용자고유번호}      
                , ${오픈뱅킹무료정책일련번호}
                , ${채널세부업무구분코드}
                , INSTC.SQ_TBUBFS012_01.NEXTVAL
                , ${오픈뱅킹무료거래건수}
                , ${오픈뱅킹무료건수갱신일시}
                , ${적용시작일시}
                , ${적용종료일시}
                , ${오픈뱅킹전문거래년월일} 
                , ${참가기관출금거래고유번호} 
                , ${참가기관입금거래고유번호} 
                , SYSTIMESTAMP
                , ${시스템최초생성식별자}
                , SYSTIMESTAMP
                , ${시스템최종갱신식별자}
                , ${시스템최종거래일시}
			)
		]]>
    </statement>

    <!-- 고객별무료거래내역조회  -->
    <statement name="selectCfreTrRmgNcn">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbPuse/cfreUtzRg/opnbCfreUtzRgEbc/selectCfreTrRmgNcn */
			       COUNT(*)  AS 오픈뱅킹무료거래건수
              FROM INSTC.TBUBFS012 A -- 고객별무료거래내역
             WHERE A.오픈뱅킹사용자고유번호 = ${오픈뱅킹사용자고유번호}
               AND A.채널세부업무구분코드   = ${채널세부업무구분코드}
               AND A.오픈뱅킹무료정책일련번호 = ${오픈뱅킹무료정책일련번호}
               AND A.오픈뱅킹무료건수갱신일시 BETWEEN ${거래시작일시} AND ${거래종료일시}
		]]>
    </statement>
    
       <!-- 무료거래내역목록조회  -->
    <statement name="selectCfreTrHisCtg">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbPuse/cfreUtzRg/opnbCfreUtzRgEbc/selectCfreTrHisCtg */
			            오픈뱅킹사용자고유번호
			     , 채널세부업무구분코드
			     , 오픈뱅킹무료정책일련번호
			     , 오픈뱅킹무료거래일련번호
			     , 오픈뱅킹무료건수갱신일시
			     , 오픈뱅킹무료거래건수      
              FROM INSTC.TBUBFS012 -- 고객별무료거래내역
             WHERE 오픈뱅킹무료건수갱신일시 BETWEEN ${거래시작일시} AND ${거래종료일시}
               AND 채널세부업무구분코드 IN (${채널세부업무구분코드} , '26')
               ORDER BY 오픈뱅킹무료정책일련번호 
                      , 오픈뱅킹무료건수갱신일시
                      , 오픈뱅킹무료거래건수 DESC
		]]>
    </statement>
    
      <!-- 무료거래내역상세조회  -->
    <statement name="selectCfreTrHisDtl">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbPuse/cfreUtzRg/opnbCfreUtzRgEbc/selectCfreTrHisDtl */
			       B.오픈뱅킹무료정책명
			     , A.채널세부업무구분코드
			     , B.오픈뱅킹무료이용유형구분코드     
			     , B.오픈뱅킹혜택구분코드
			     , B.오픈뱅킹혜택대상내용
			     , A.오픈뱅킹무료건수갱신일시
			     , A.오픈뱅킹무료거래건수
			     , B.오픈뱅킹무제한여부
			     , B.오픈뱅킹기간구분코드			     
              FROM INSTC.TBUBFS012 A  
                 , INSTC.TBUBFS013 B 
             WHERE A.오픈뱅킹무료정책일련번호 = B.오픈뱅킹무료정책일련번호
               AND A.오픈뱅킹사용자고유번호 = ${오픈뱅킹사용자고유번호}
               AND A.채널세부업무구분코드   = ${채널세부업무구분코드}
               AND A.오픈뱅킹무료정책일련번호 = ${오픈뱅킹무료정책일련번호}
               AND A.오픈뱅킹무료거래일련번호  = ${오픈뱅킹무료거래일련번호}
		]]>
    </statement>
    
    <!-- 무료거래내역존재여부조회  -->
    <statement name="selectCfreTnhsExstYn">
		<![CDATA[
			SELECT /*+ 정영훈::/opnb/opnbPuse/cfreUtzRg/opnbCfreUtzRgEbc/selectCfreTnhsExstYn */
			       'Y' AS 존재여부
              FROM INSTC.TBUBFS012
             WHERE 오픈뱅킹무료정책일련번호 = ${오픈뱅킹무료정책일련번호}
               AND ROWNUM = 1
		]]>
    </statement>
    
  
</statements>
