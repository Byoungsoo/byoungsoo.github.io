<?xml version="1.0" encoding="EUC-KR"?>
<statements>

	<!-- 사용자고유번호조회 -->
    <statement name="selectUsrUno">
		<![CDATA[
			SELECT /*+ 김상현::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/selectUsrUno */
		 	            오픈뱅킹사용자고유번호
	          FROM INSTC.TBUBFS001        /* UBF오픈뱅킹고객정보기본 */
	         WHERE (CI내용				= ${CI_내용}			OR ${CI_내용}		IS NULL)
	           AND (고객식별자				= ${고객식별자}		OR ${고객식별자}	IS NULL)
	           AND (준회원식별자			= ${준회원식별자}		OR ${준회원식별자}	IS NULL)
	           AND 오픈뱅킹서비스해지여부		= 'N'
		]]>
    </statement>
    
    <!-- 등록채널목록조회 -->
    <statement name="selectRgChnCtg">
		<![CDATA[
			SELECT DISTINCT /*+ 김상현::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/selectRgChnCtg */
		 	       B.채널세부업무구분코드
	          FROM INSTC.TBUBFS001 A, INSTC.TBUBFS003 B	/* UBF오픈뱅킹고객기본, UBF오픈뱅킹계좌상세 */
	         WHERE A.오픈뱅킹사용자고유번호	= ${오픈뱅킹사용자고유번호}
               AND A.오픈뱅킹서비스해지여부	= 'N'
               AND A.CI내용				= B.CI내용
               AND B.계좌상세사용여부		= 'Y'
	         UNION
	        SELECT DISTINCT
	               D.채널세부업무구분코드
	          FROM INSTC.TBUBFS001 C, INSTC.TBUBFS006 D	/* UBF오픈뱅킹고객기본, UBF오픈뱅킹카드고객상세 */ 
	         WHERE C.오픈뱅킹사용자고유번호	= ${오픈뱅킹사용자고유번호}
               AND C.오픈뱅킹서비스해지여부	= 'N'
	           AND C.CI내용				= D.CI내용
               AND D.카드정보조회동의여부		= 'Y'
		]]>
    </statement>
    
    <!--  등록여부 조회  -->
    <statement name="selectRgYn">
		<![CDATA[
			SELECT /*+ 김정화::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/selectRgYn */
		 	      오픈뱅킹사용자고유번호
	          FROM INSTC.TBUBFS001       /* UBF오픈뱅킹고객정보기본 */
	         WHERE 오픈뱅킹사용자고유번호	= ${오픈뱅킹사용자고유번호}
		]]>
    </statement>
    
    <statement name="insertOpnbCstInfBas">
		<![CDATA[
			INSERT /*+ 임헌택::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/insertOpnbCstInfBas */
	          INTO INSTC.TBUBFS001        /* UBF오픈뱅킹고객정보기본 */
		    	 (
		 	           오픈뱅킹사용자고유번호
                , 고객식별자
                , 준회원식별자
                , 고객명
                , CI내용
                , 오픈뱅킹주민등록번호
                , 오픈뱅킹사용자휴대폰번호
                , 성별구분코드
                , 고객출생년월일
                , 오픈뱅킹통합계좌조회동의여부
                , 통합계좌조회동의해제일시
                , 오픈뱅킹서비스해지여부
                , 시스템최초생성일시
                , 시스템최초생성식별자
                , 시스템최종갱신일시
                , 시스템최종갱신식별자
                , 시스템최종거래일시			
			    )
			     VALUES
			    (
			      ${오픈뱅킹사용자고유번호}
                , ${고객식별자}
                , ${준회원식별자}
                , ${고객명}
                , ${CI내용}
                , ${오픈뱅킹주민등록번호}
                , ${오픈뱅킹사용자휴대폰번호}
                , ${성별구분코드}
                , ${고객출생년월일}
                , ${오픈뱅킹통합계좌조회동의여부}
                , TO_DATE(${통합계좌조회동의해제일시},'YYYYMMDDHH24MISS')
                , ${오픈뱅킹서비스해지여부}
                , SYSTIMESTAMP
                , ${시스템최초생성식별자}
                , SYSTIMESTAMP
                , ${시스템최종갱신식별자}
                , ${시스템최종거래일시}
			)
		]]>
    </statement>

    <!-- 오픈뱅킹고객동의여부수정 -->
    <statement name="uptOpnbCstCnsYn">
		<![CDATA[
			UPDATE /*+ 정영훈::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/uptOpnbCstCnsYn */ 
                   INSTC.TBUBFS001        /* UBF오픈뱅킹고객정보기본 */
               SET 오픈뱅킹통합계좌조회동의여부 = NVL(${오픈뱅킹통합계좌조회동의여부} , 오픈뱅킹통합계좌조회동의여부) 
                 , 통합계좌조회동의해제일시      = NVL(TO_DATE(${통합계좌조회동의해제일시},'YYYYMMDDHH24MISS')    , 통합계좌조회동의해제일시)
                 , 오픈뱅킹서비스해지여부        = NVL(${오픈뱅킹서비스해지여부}      , 오픈뱅킹서비스해지여부)
                 , 시스템최종갱신일시             = SYSTIMESTAMP  
                 , 시스템최종갱신식별자           = ${시스템최종갱신식별자}        
                 , 시스템최종거래일시       = ${시스템최종거래일시}     
             WHERE 오픈뱅킹사용자고유번호        = ${오픈뱅킹사용자고유번호}
		]]>
    </statement>
    
     <!-- 오픈뱅킹고객기본삭제 -->
    <statement name="deleteOpnbCstBas">
		<![CDATA[
	       DELETE /*+ 정영훈::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/deleteOpnbCstBas */
             FROM INSTC.TBUBFS001
            WHERE 오픈뱅킹사용자고유번호 = ${오픈뱅킹사용자고유번호} 		
		]]>
    </statement>
    
    <!-- 계좌상세사용여부수정 -->
    <statement name="updateAccDtlUseYn">
		<![CDATA[
			UPDATE /*+ 김정화::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/updateAccDtlUseYn */ 
                   INSTC.TBUBFS003        /* UBF오픈뱅킹계좌상세 */
               SET 계좌상세사용여부                = ${계좌상세사용여부}
                 , 출금동의여부                     = NVL(${출금동의여부}, 출금동의여부)
                 , 시스템최종갱신일시             = SYSTIMESTAMP      
                 , 시스템최종갱신식별자           = ${시스템최종갱신식별자}        
                 , 시스템최종거래일시             =  ${시스템최종거래일시}  
             WHERE 채널세부업무구분코드   = ${채널세부업무구분코드}
               AND CI내용                    =  ${CI내용}
		]]>
    </statement>
    
    <!-- 오픈뱅킹계좌상세등록계좌수조회 -->
    <statement name="selectOpnbAccDtlRgAccnt">
		<![CDATA[ 
			SELECT /*+ 김정화::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/selectOpnbAccDtlRgAccnt */
                   COUNT(*) 등록계좌수
              FROM INSTC.TBUBFS003
             WHERE CI내용                   =  ${CI내용}
               AND 계좌상세사용여부       = ${계좌상세사용여부}
               
		]]>
    </statement>

    <!-- 계좌기본사용여부수정 -->
    <statement name="updateAccBasUseYn">
		<![CDATA[
			UPDATE /*+ 김정화::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/updateAccBasUseYn */ 
                   INSTC.TBUBFS002        /* UBF오픈뱅킹계좌기본 */
               SET 계좌사용여부                     = ${계좌사용여부}               
                 , 계좌조회동의여부                = ${계좌조회동의여부}    
                 , 계좌조회동의해제일시            = SYSTIMESTAMP
                 , 조회해제채널세부업무구분코드  = ${해제채널세부업무구분코드}                
                 , 출금동의여부                     = ${출금동의여부}      
                 , 출금동의해제일시                 = SYSTIMESTAMP
                 , 출금해제채널세부업무구분코드  = ${해제채널세부업무구분코드}
                 , 시스템최종갱신일시              = SYSTIMESTAMP      
                 , 시스템최종갱신식별자           = ${시스템최종갱신식별자}        
                 , 시스템최종거래일시             =${시스템최종거래일시}
             WHERE 오픈뱅킹사용자고유번호 = ${오픈뱅킹사용자고유번호}
               
		]]>
    </statement>
    
    <!-- 오픈뱅킹계좌카드사용가능건수조회 -->         
    <statement name="selectOpnbAccCrdUseAblNcn">
		<![CDATA[ 
			SELECT /*+ 정영훈::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/selectOpnbAccCrdUseAblNcn */
			       SUM(CNT) AS 사용가능건수
			 FROM (      
				     SELECT COUNT(*) AS CNT
		           FROM INSTC.TBUBFS002
		          WHERE 계좌사용여부 = 'Y'
		            AND 오픈뱅킹사용자고유번호 = ${오픈뱅킹사용자고유번호}
		              
		          UNION ALL
		             
		         SELECT COUNT(*) AS CNT   
		           FROM INSTC.TBUBFS005
		          WHERE 카드정보조회동의여부 = 'Y'
		            AND 오픈뱅킹사용자고유번호 = ${오픈뱅킹사용자고유번호}
		        )    
		]]>
    </statement>
    
    <!-- CI내용조회 -->         
    <statement name="selectCiCtt">
		<![CDATA[ 
			SELECT /*+ 김정화::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/selectCiCtt */
	 	        	CI내용
          FROM INSTC.TBUBFS001        /* UBF오픈뱅킹고객정보기본 */
         WHERE 오픈뱅킹사용자고유번호		= ${오픈뱅킹사용자고유번호} 
		]]>
    </statement>
    
    <!-- 카드상세사용여부수정 -->
    <statement name="updateCrdDtlUseYn">
		<![CDATA[
			UPDATE /*+ 김정화::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/updateCrdDtlUseYn */ 
                   INSTC.TBUBFS006        /* UBF오픈뱅킹카드고객상세 */
               SET 카드정보조회동의여부                = ${카드정보조회동의여부}
                 , 카드정보조회동의해제일시            = SYSTIMESTAMP      
                 , 시스템최종갱신일시             = SYSTIMESTAMP      
                 , 시스템최종갱신식별자           = ${시스템최종갱신식별자}        
                 , 시스템최종거래일시             =  ${시스템최종거래일시}  
             WHERE 채널세부업무구분코드   = ${채널세부업무구분코드}
               AND CI내용                    =  ${CI내용}
               
		]]>
    </statement>
    
    <!-- 오픈뱅킹카드고객상세등록계좌수조회 -->
    <statement name="selectOpnbCrdCstDtlRgCrdCstCnt">
		<![CDATA[ 
			SELECT /*+ 김정화::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/selectOpnbCrdCstDtlRgCrdCstCnt */
                   COUNT(*) 등록카드고객수
              FROM INSTC.TBUBFS006
             WHERE CI내용                   =  ${CI내용}
               AND 카드정보조회동의여부       = ${카드정보조회동의여부}
		]]>
    </statement>
    
    <!-- 카드고객기본사용여부수정 -->
    <statement name="updateCrdCstBasUseYn">
		<![CDATA[
			UPDATE /*+ 김정화::/opnb/opnbPuse/usrSvc/OpnbUsrMgEbc/updateCrdCstBasUseYn */ 
                   INSTC.TBUBFS005        /* UBF오픈뱅킹카드기본 */
               SET 카드정보조회동의여부                = ${카드정보조회동의여부}    
                 , 카드정보조회동의해제일시            = SYSTIMESTAMP
                 , 조회해제채널세부업무구분코드  = ${조회해제채널세부업무구분코드}                
                 , 시스템최종갱신일시              = SYSTIMESTAMP      
                 , 시스템최종갱신식별자           = ${시스템최종갱신식별자}        
                 , 시스템최종거래일시             =  ${시스템최종거래일시}  
             WHERE 오픈뱅킹사용자고유번호 = ${오픈뱅킹사용자고유번호}
               
		]]>
    </statement>
    
</statements>
