---
layout: post
title: "Project - KBCard 성능테스트"
author: "Bys"
category: project
date: 2021-04-03 01:00:00
tags: project issue
---

#### **- 성능테스트**  

성능 테스트는 시간당 사용자수, 분당 사용자수, 초당 사용자수, 사용자당 트랜잭션 수 등을 통해 초당 트랜잭션 수를  계산한다.  
이 번 성능테스트의 목표 TPS는 2100 TPS로 목표 응답시간은 2초 이내 응답이다.  

테스트 시나리오는 3개의 시나리오로 진행한다.  
1. 목표 성능 테스트 - 복합 업무를 대상으로 산정된 목표 부하를 부여하였을 때, 성능 목표에 도달 하는지 여부를 확인  
대상업무: API 4개  //  부하발생: 5분간 Ramp Up  //  부하지속: 10분간 지속

![k01](/assets/it/project/kbcard/mydata/k01.png){: width="60%" height="auto"}  

2. 임계부하 성능 테스트 - 복합 업무를 대상으로 최대 부하를 부여하였을 때, 처리 가능한 최대 TPS 수준을 확인
대상업무: API 4개  //  부하발생: 1초당 1명씩 Ramp Up  //  부하지속: 최대 TPS 도달 시 종료  

![k02](/assets/it/project/kbcard/mydata/k02.png){: width="60%" height="auto"}  

3. 장시간 안정성 테스트 - 목표 부하 성능테스트를 장시간(최소6시간) 수행하여 시스템의 장시간 부하 영향을 확인  
대상업무: API 4개  //  부하지속: 6시간 ~ 24시간  

![k03](/assets/it/project/kbcard/mydata/k03.png){: width="60%" height="auto"}  

<br><br>

#### **- 성능테스트 - UBF 튜닝1**  

초기 4개의 Pod에서 부하를 시작하였을 때, Scale-Out이 되면서 갑자기 모든 Pod에 부하가 걸리면서 죽는 현상이 발생하였다.  
Scale-Out이 되었지만 Scale-Out 된 Pod로 아직은 부하가 들어오기 전이라는 시점이 이상하여 Scale-Out이 문제였는지, 아니면 다른게 이상했는지 판단하기가 어려웠다.  
그래서 다시 한 번 테스트 수행을 요청하였고, 이번에는 Scale-Out이 되기 전에 죽는현상이 있었다.  

따라서 기존 소스코드에 무엇이 문제였는지 파악이 시급했다.  

![k04](/assets/it/project/kbcard/mydata/k04.png){: width="90%" height="auto"}  

Jennifer 상에서 증가하는 응답시간을 잡아보니 실제 SQL 수행시간이 오래걸렸고 해당 Query에 대한 튜닝을 진행하고 나서야 정상 응답시간으로 복구하였다.  

![k05](/assets/it/project/kbcard/mydata/k05.png){: width="90%" height="auto"}  

<br><br>



#### **- 성능테스트 - UBF 튜닝3**  

부하가 들어오기 시작 하고 나서부터 응답시간이 지속적으로 올라가기 시작했다.  

![k04](/assets/it/project/kbcard/mydata/k04.png){: width="90%" height="auto"}  

Jennifer 상에서 증가하는 응답시간을 잡아보니 실제 SQL 수행시간이 오래걸렸고 해당 Query에 대한 튜닝을 진행하고 나서야 정상 응답시간으로 복구하였다.  

![k05](/assets/it/project/kbcard/mydata/k05.png){: width="90%" height="auto"}  

<br><br>


#### **- 성능테스트 - UBF 튜닝4**  

부하가 들어오기 시작 하고 나서부터 응답시간이 지속적으로 올라가기 시작했다.  

![k04](/assets/it/project/kbcard/mydata/k04.png){: width="90%" height="auto"}  

Jennifer 상에서 증가하는 응답시간을 잡아보니 실제 SQL 수행시간이 오래걸렸고 해당 Query에 대한 튜닝을 진행하고 나서야 정상 응답시간으로 복구하였다.  

![k05](/assets/it/project/kbcard/mydata/k05.png){: width="90%" height="auto"}  

<br><br>
