---
layout: post
title: "소스 리팩토링에 대한 간단한 생각"
author: "Bys"
category: thinking
date: 2022-04-14 01:00:00
tags: thinking work
---

최근 Spring Boot관련된 책과 문서를 좀 보면서 Spring Cloud에 대한 내용을 보았다. 
이걸 보니 문득 내가 개발하고 있는 거대한 소스코드가 떠 올랐다. 

레거시 소스가 거대해지는 것을 바라보며 추후에 리팩토링에 대한 생각을 한 번 해보게되었다. 
물론 지금은 트래픽이 많지 않고 사용량이 적기 때문에 들어가는 에포트에 비하면 효과가 없을거라 이런 고려는 아무도 하지 않을 것이다. 
하지만 복잡해지는 소스들을 보며 잘 정리를 하고 싶은 생각도 들었다. 

간단하게 생각하는 것은 클라우드 서비스를 위한 포탈을 어플리케이션은 마이크로 서비스형태로 변경해 나가는 것이다. 

프레임워크는 스프링 부트와 스프링 클라우드를 사용하여 구성하면 어떨까 싶다. 
Network Service / Compute Service & Octavia Service / Storage Service / Monitoring Service / Billing Service / Authenticate & Authorization Service 등과 같은 서비스들로 Application을 나눈다. 
각 마이크로서비스들의 부트 설정은 Cloud Config Server를 통해 관리한다. 

인프라 아키텍처는 각 서비스들을 컨테이너로 배포하며 컨테이너 오케스트레이션 툴은 Kubernetes를 사용한다. 
Nginx Ingress 컨트롤러를 사용하여 앞단에 Gateway 역할을 하고 뒷단에 서비스로 로드밸런싱역할을 해준다. 

이 외 모니터링과 추적 로깅등을 위해서는 사이드카 패턴을 사용한다.
서비스별 모니터링은 프로메테우스와 그라파나를 통해 통합 모니터링환경을 구축하고,
Zipkin을 이용하여 마이크로서비스간 분산 추적이 가능한 환경을 구성하고, 로깅환경으로는 기존에 있는 Elasticsearch와 Kibana를 이용하여 EFK 환경을 구성한다. 

위에 내용으로만 시스템 리펙토링을 진행해도 엄청나게 큰 양이 될 것으로 보인다. 
추후에 해당 시스템이 서비스 종료 되지않고 지속적으로 사용되며 트래픽이 늘어나 견디기 힘든상황까지 온다면 꼭 해보고 싶은 일이다. 

만약 견디기 힘든 시스템 상황이 되고 이 일이 진행이 된다면 확장성 측면, 안정성 측면, 유지보수 측면에서 훨씬 유리할 것으로 보인다. 




